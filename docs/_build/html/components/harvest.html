
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Harvest &#8212; DKAN2 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/all.min.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Topics" href="topics.html" />
    <link rel="prev" title="Datastore" href="datastore.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="harvest">
<h1>Harvest<a class="headerlink" href="#harvest" title="Permalink to this headline">¶</a></h1>
<p>To “harvest” data is to use the public feed or API of another data portal to import items from that portal’s catalog into your own.
For example, <a class="reference external" href="https://data.gov/">Data.gov</a> harvests all of its datasets from the <a class="reference external" href="https://project-open-data.cio.gov/v1.1/schema/">data.json</a> files of <a class="reference external" href="https://catalog.data.gov/harvest">hundreds of U.S. federal, state and local data portals</a>.</p>
<p>DKAN Harvest uses the local file system to store source information in cache and plan files.</p>
<div class="section" id="drush-commands">
<h2>Drush Commands<a class="headerlink" href="#drush-commands" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 25%" />
<col style="width: 15%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Args</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dkan-harvest:list</p></td>
<td><p>n/a</p></td>
<td><p>Lists avaialble harvests.</p></td>
</tr>
<tr class="row-odd"><td><p>dkan-harvest:register</p></td>
<td><p>$config</p></td>
<td><p>Register a new harvest, file saved to <em>dkan_harvest/plans</em> directory.</p></td>
</tr>
<tr class="row-even"><td><p>dkan-harvest:deregister</p></td>
<td><p>$identifier</p></td>
<td><p>Deletes the cached plan file.</p></td>
</tr>
<tr class="row-odd"><td><p>dkan-harvest:cache</p></td>
<td><p>$identifier</p></td>
<td><p>This will fetch the source data, apply the source configuration and cache the data to a local file.</p></td>
</tr>
<tr class="row-even"><td><p>dkan-harvest:run</p></td>
<td><p>$identifier</p></td>
<td><p>This will harvest the current cache for the selected sources.</p></td>
</tr>
<tr class="row-odd"><td><p>dkan-harvest:revert</p></td>
<td><p>$identifier</p></td>
<td><p>Reverts harvest.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Currently there is no UI for the harvests, use the drush commands above to harvest data:</p>
<p>To register a new harvest source, pass in the config argument as JSON:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dkan</span><span class="o">-</span><span class="n">harvest</span><span class="p">:</span><span class="n">register</span> <span class="s1">&#39;{&quot;identifier&quot;:&quot;dkandemo&quot;,&quot;source&quot;:{&quot;type&quot;:&quot;</span><span class="se">\\</span><span class="s1">Harvest</span><span class="se">\\</span><span class="s1">Extract</span><span class="se">\\</span><span class="s1">DataJson&quot;,&quot;uri&quot;:&quot;http:\/\/demo.getdkan.com\/data.json&quot;},&quot;transforms&quot;:[{&quot;Filter&quot;:{&quot;keyword&quot;:&quot;environment&quot;}},{&quot;Override&quot;:{&quot;publisher.name&quot;:&quot;DKAN Demo&quot;}},&quot;</span><span class="se">\\</span><span class="s1">Drupal</span><span class="se">\\</span><span class="s1">dkan_harvest</span><span class="se">\\</span><span class="s1">Transform</span><span class="se">\\</span><span class="s1">DataJsonToDkan&quot;],&quot;load&quot;:{&quot;type&quot;:&quot;</span><span class="se">\\</span><span class="s1">Drupal</span><span class="se">\\</span><span class="s1">dkan_harvest</span><span class="se">\\</span><span class="s1">Load</span><span class="se">\\</span><span class="s1">Dataset&quot;}}&#39;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>That source config looks like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;identifier&quot;</span><span class="p">:</span> <span class="s2">&quot;dkandemo&quot;</span><span class="p">,</span>
  <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;\\Harvest\\Extract\\DataJson&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http:\/\/demo.getdkan.com\/data.json&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;transforms&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;Filter&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;keyword&quot;</span><span class="p">:</span> <span class="s2">&quot;environment&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="nt">&quot;Override&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;publisher.name&quot;</span><span class="p">:</span> <span class="s2">&quot;DKAN Demo&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;\\Drupal\\dkan_harvest\\Transform\\DataJsonToDkan&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;load&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;migrate&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;collectionsToUpdate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;license&quot;</span><span class="p">,</span> <span class="s2">&quot;theme&quot;</span><span class="p">,</span> <span class="s2">&quot;keyword&quot;</span><span class="p">],</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;\\Drupal\\dkan_harvest\\Load\\Dataset&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>About the load configs</p>
<ul class="simple">
<li><p><strong>identifier</strong>: The plan’s identifier. Required.</p></li>
<li><p><strong>source</strong>: Required.</p>
<ul>
<li><p><strong>type</strong>: Class utilized to extract the data from the source. Required.</p></li>
<li><p><strong>uri</strong>: The URL or Location of the Source. Required.</p></li>
</ul>
</li>
<li><p><strong>transforms</strong>: Required.</p>
<ul>
<li><p><strong>type</strong>: Class utilized to transform the data OR null.</p></li>
</ul>
</li>
<li><p><strong>load</strong>: Required.</p>
<ul>
<li><p><strong>migrate</strong>: whether or not files should be downloaded locally.</p></li>
<li><p><strong>collectionsToUpdate</strong>: after the initial harvest you might not want to update anything but datasets.</p></li>
<li><p><strong>type</strong>: Class utilized to load the harvested data. Required.</p></li>
</ul>
</li>
</ul>
</div>
<p>Project Open Data (as well as most metadata APIs) includes many fields that are not simple key-value pairs. If you need to access or modify nested array values you can use this dot syntax to specify the path: <cite>key.nested_key.0.other_nested_key</cite>. For example, the Publisher field in Project Open Data is expressed like this:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;publisher&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;@type&quot;</span><span class="o">:</span> <span class="s2">&quot;org:Organization&quot;</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;demo.getdkan.com&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
</div>
<div class="section" id="transforms">
<h2>Transforms<a class="headerlink" href="#transforms" title="Permalink to this headline">¶</a></h2>
<p>The transform options include four multi-value fields to help you fine tune the results of your harvest.</p>
<dl class="field-list simple">
<dt class="field-odd">Filters</dt>
<dd class="field-odd"><p>Filters restrict the datasets imported by a particular field. For instance, if you are harvesting a data.json source and want only to harvest health-related datasets, you might add a filter with “keyword” in the first text box, and “heatlh” in the second.</p>
</dd>
<dt class="field-even">Excludes</dt>
<dd class="field-even"><p>Excludes are the inverse of filters. For example, if you know there is one publisher listed on the source whose datasets you do <strong>not</strong> want to bring into your data portal, you might add “publisher.name” with value “Governor’s Office of Terrible Data”</p>
</dd>
<dt class="field-odd">Overrides</dt>
<dd class="field-odd"><p>Overrides will replace values from the source when you harvest. For instance, if you want to take responsibility for the datasets once harvested and add your agency’s name as the publisher, you might add “publisher.name” with your agency’s name as the value.</p>
</dd>
<dt class="field-even">Defaults</dt>
<dd class="field-even"><p>Defaults work the same as overrides, but will only be used if the relevant field is empty in the source</p>
</dd>
</dl>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">DKAN2</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Major Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dataset.html">Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="datastore.html">Datastore</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Harvest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#drush-commands">Drush Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transforms">Transforms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="topics.html">Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="decoupled.html">Decoupled Front-end</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">DKAN Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About this documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Major Components</a><ul>
      <li>Previous: <a href="datastore.html" title="previous chapter">Datastore</a></li>
      <li>Next: <a href="topics.html" title="next chapter">Topics</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/components/harvest.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>